<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SQL Dashboard</title>
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    </head>
    <body class="bg-gray-100">
        <div class="container mx-auto p-4">
            <h1 class="text-2xl font-bold mb-4">SQL Dashboard</h1>
            <div class="mb-4">
                <h2 class="text-xl font-semibold">Tables:</h2>
                <ul>
                    {% for table_name in table_names %}
                    <li class="cursor-pointer" onclick="getTableData('{{ table_name }}')">{{ table_name }}</li>
                    {% endfor %}
                </ul>
            </div>
            <form id="query-form" class="mb-4">
                <textarea id="query" class="w-full p-2 border border-gray-300 rounded" rows="4" placeholder="Enter your SQL query here"></textarea>
                <button type="submit" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded">Run Query</button>
            </form>
            <div id="results"></div>
        </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function getTableData(tableName) {
            axios.get('/get_table_data/' + tableName)
                .then(response => {
                    const data = response.data;
                    let html = '';
                    if (data.status === 'success') {
                        html += '<table class="w-full border-collapse"><thead class="bg-gray-200"><tr>';
                        data.columns.forEach(column => {
                            html += `<th class="border p-2">${column}</th>`;
                        });
                        html += '</tr></thead><tbody>';
                        data.data.forEach(row => {
                            html += '<tr>';
                            data.columns.forEach(column => {
                                html += `<td class="border p-2">${row[column]}</td>`;
                            });
                            html += '</tr>';
                        });
                        html += '</tbody></table>';
                    } else {
                        html = `<div class="bg-red-100 text-red-700 p-2 rounded">${data.message}</div>`;
                    }
                    document.getElementById('results').innerHTML = html;
                })
                .catch(error => {
                    console.error(error);
                });
        }

        document.getElementById('query-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData();
        formData.append('query', document.getElementById('query').value);

        axios.post('/run_query', formData)
            .then(response => {
                const data = response.data;
                let html = '';
                if (data.status === 'success') {
                    html += '<table class="w-full border-collapse"><thead class="bg-gray-200"><tr>';
                    for (const key in data.data[0]) {
                        html += `<th class="border p-2">${key}</th>`;
                    }
                    html += '</tr></thead><tbody>';
                    data.data.forEach(row => {
                        html += '<tr>';
                        for (const key in row) {
                            html += `<td class="border p-2">${row[key]}</td>`;
                        }
                        html += '</tr>';
                    });
                    html += '</tbody></table>';
                } else {
                    html = `<div class="bg-red-100 text-red-700 p-2 rounded">${data.message}</div>`;
                }
                document.getElementById('results').innerHTML = html;
            })
            .catch(error => {
                console.error(error);
            });
    });
    </script>
</body>
</html>